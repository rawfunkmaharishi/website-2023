---
import RecordSlide from "./slides/RecordSlide.astro";
import MusicianSlide from "./slides/MusicianSlide.astro";
import EventSlide from "./slides/EventSlide.astro";
import PromoSlide from "./slides/PromoSlide.astro";

const { items, wrapAround } = Astro.props;

function cellId(index) {
  return "cell-" + index;
}
---

<ul class="main-carousel">
  {
    items.map((item, index) => (
      <li
        class="carousel-cell"
        id={cellId(index)}
        data-title={item.additionalTitle}
      >
        {item["@type"] == "MusicAlbum" && <RecordSlide record={item} />}

        {item["@type"] == "Person" && <MusicianSlide musician={item} />}

        {item["@type"] == "MusicEvent" && (
          <EventSlide eventSet={item} dateFormat="dddd MMM Do" />
        )}

        {item["@type"] == "Video" && (
          <EventSlide eventSet={item} dateFormat="MMMM YYYY" type="videos" />
        )}

        {item["@type"] == "Promo" && <PromoSlide data={item} />}
      </li>
    ))
  }
</ul>

<script define:vars={{ wrapAround: wrapAround }}>
  function setTitle(index) {
    const cell = document.getElementById("cell-" + index);
    if (cell.dataset.title) {
      document.getElementById("main-title").textContent = cell.dataset.title;
    }
  }

  var elem = document.querySelector(".main-carousel");
  var flkty = new Flickity(elem, {
    wrapAround: wrapAround,
    autoPlay: 3000,
    on: {
      ready: function () {
        setTitle(0);
      },
    },
  });

  flkty.on("change", function (index) {
    setTitle(index);
  });
</script>

<style>
  li {
    margin-inline: 15%;
  }

  ul {
    height: 65dvw;
  }

  @media only screen and (min-width: 600px) {
    ul {
      height: 60dvh;
      width: 90%;
      margin-inline: auto;
    }
  }
</style>

<style is:global>
  .flickity-button {
    background-color: var(--colour-link);
    top: 25dvw;
  }

  .flickity-button:hover {
    background-color: var(--colour-hover);
  }

  .flickity-button:focus {
    outline: none;
    box-shadow: none;
  }

  .flickity-page-dots .dot {
    width: 12px;
    height: 12px;
    opacity: 1;
    margin-inline: 0.3rem;
    background: transparent;
    border-width: 1px;
    border-style: solid;
    border-color: var(--colour-link);
  }

  .flickity-page-dots .dot.is-selected {
    background: var(--colour-link);
  }

  @media only screen and (min-width: 600px) {
    .flickity-button {
      top: 15dvw;
    }
  }
</style>

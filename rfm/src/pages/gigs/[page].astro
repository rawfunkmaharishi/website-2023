---
import moment from "moment";
import "@mdi/font/css/materialdesignicons.css";

import Layout from "../../layouts/Layout.astro";
import { futureGigs } from "../../lib/tools";

export async function getStaticPaths({ paginate }) {
  const gigs = await futureGigs().then(function (items) {
    return items.map((gig) => {
      return {
        href: gig.url,
        date: gig.startDate.slice(0, 10),
        name: gig.location.name,
      };
    });
  });
  return paginate(gigs, { pageSize: 4 });
}

const { page } = Astro.props;
---

<Layout title="Upcoming Gigs">
  <div class="paginated-links">
    <ul>
      {
        page.data.map((gig) => (
          <li>
            <a href={gig.href}>
              {moment(gig.date).format("dddd MMM Do")}
              <span class="venue">{gig.name}</span>
            </a>
          </li>
        ))
      }
    </ul>

    <div id="paginators">
      {
        (page.url.prev && <a href={page.url.prev}>«</a>) || (
          <span class="dead">«</span>
        )
      }
      {
        (page.url.next && <a href={page.url.next}>»</a>) || (
          <span class="dead">»</span>
        )
      }
    </div>
  </div>
</Layout>

---
import Layout from "../layouts/Layout.astro";

import { colours } from "../conf/colours";
---

<Layout title="QR Code">
  <canvas id="qr"></canvas>
</Layout>

<style>
  canvas {
    margin-inline: auto;
    display: block;
  }
</style>

<script
  define:vars={{
    url: import.meta.env.SITE,
    fg: colours.primary,
    bg: colours.background
  }}
>
  var canvas = document.getElementById("qr");

  QRCode.toCanvas(
    canvas,
    url,
    {
      width: 300,
      color: {
        dark: fixColour(fg),
        light: fixColour(bg),
      },
    },
    function (error) {
      if (error) console.error(error);
      console.log("success!");
    }
  );

  function fixColour(rgb) {
    return (
      "#" +
      rgb
        .split("(")[1]
        .split(")")[0]
        .split(",")
        .map(parseFloat)
        .map((number) => number.toString(16).padStart(2, 0))
        .join("")
    );
  }
</script>

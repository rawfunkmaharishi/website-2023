---
import moment from "moment";
import "@mdi/font/css/materialdesignicons.css";

import Layout from "../../layouts/Layout.astro";
import VideoModal from "../../components/VideoModal.astro";
import VideoModalLink from "../../components/VideoModalLink.astro";
import { fetchFromAPI, streamingServices } from "../../lib/tools";

export async function getStaticPaths() {
  return await fetchFromAPI("records").then(function (records) {
    return records.map((record) => {
      return {
        params: {
          record: record["identifier"],
        },
        props: { record },
      };
    });
  });
}

const { record } = Astro.props;

const title = record.name;
const releaseDate = moment(record.datePublished).format("MMMM YYYY");

// https://stackoverflow.com/a/7220510
const jsonLD = JSON.stringify(record, null, 2);
const services = streamingServices(record.sameAs);
---

<Layout title={title} jsonLD={jsonLD}>
  <div class="record">
    <img class="record-sleeve" src={record.image.contentUrl} />
    <ul class="streaming-services">
      {services.map((service) => <VideoModalLink data={service} />)}
    </ul>

    <ol class="track-list">
      {record.track.map((trk) => <li>{trk.name}</li>)}
    </ol>

    <h3>{releaseDate}</h3>
  </div>
  {services.map((service) => <VideoModal data={service} />)}

  <style>
    div.record {
      display: grid;
      /* grid-template-rows: auto auto; */
      justify-content: center;
      gap: 1rem;
    }

    img {
      max-width: 80%;
      margin-inline: auto;
    }

    h3 {
      text-align: center;
    }

    ul {
      display: flex;
      font-size: 2rem;
      gap: 1rem;
      justify-content: center;
    }

    ol {
      margin-inline: auto;
      padding-left: 1rem;
      counter-reset: counter;
    }

    ol li {
      counter-increment: counter;
    }

    ol li::before {
      content: counter(counter) ": ";
      font-size: 0.7rem;
    }
  </style>
</Layout>
